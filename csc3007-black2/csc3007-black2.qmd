---
title: "CSC3007-Team-Black-2"
footer: "CHIA YI XUAN, TSUI SAU CHI, JEANIE OH JUN NING, VARADHARAJAN JAYAPRIYA, GU JINMING, WONG JUN HAO"
format:
  revealjs: 
    slide-number: true
    transition: slide
    theme: solarized
    center: true
    include-in-header: 
      text: |
        <style>
        .center-xy {
          margin: 0;
          position: absolute;
          top: 50%;
          left: 50%;
          -ms-transform: translateY(-50%), translateX(-50%);
          transform: translateY(-50%), translateX(-50%);
        }
        </style>
---
---

```{r}
#| label: required-packages
#| message: false

library(tidyverse)
library(countrycode)
library(directlabels)
library(ggrepel)
library(dplyr)
library(lintr)
library(readxl)
library(scales)
library(tmap)
library(GGally)
library(ggplot2)
library(plotly)
library(recipes)
library(priceR)
library(sf)
library(tidymodels)
library(rpart)
library(rpart.plot)
library(caret)
library(DT)
library(knitr)
library(factoextra)
```

```{r}
#| label: prepare-data
#| echo: false

# Load & Clean the dataset / prepare it here.
# Load 5.1.1 data - Legal frameworks that promote enforce and monitor gender
# equality (percentage of achievement 0 - 100) \--
# Area 3: employment and economic benefits
indicator_5_1_1_frameworks <-
  read_csv(
    "data/Indicator_5.1.1_legal_area_3.csv",
    show_col_types = FALSE
  )

# Load 5.5.2 data - Proportion of women in managerial positions
indicator_5_5_2_managerial <-
  read_csv(
    "data/Indicator_5.5.2_women_in_managerial_positions.csv",
    show_col_types = FALSE
  )

# Load 8.5.1 data - Average hourly earnings of employees by sex, age, occupation
# and persons with disabilities
indicator_8_5_1_average_hourly <-
  read_csv(
    "data/Indicator_8.5.1_Average_hourly_earnings.csv",
    show_col_types = FALSE
  )

# Load 8.5.2 data - Unemployment rate by sex, age and persons with disabilities
indicator_8_5_2_unemployment <-
  read_csv(
    "data/Indicator_8.5.2_Unemployment_rate.csv",
    show_col_types = FALSE
  )

# Load Map Geometry data from Tmap
data(World)

# Clean data
indicator_5_1_1_frameworks <-
  indicator_5_1_1_frameworks |> select(indicator_reference,
                                       geoAreaName,
                                       parentName,
                                       type,
                                       X,
                                       Y,
                                       ISO3,
                                       latest_value)

indicator_5_5_2_managerial <-
  indicator_5_5_2_managerial |> select(indicator_reference,
                                       geoAreaName,
                                       parentName,
                                       type,
                                       X,
                                       Y,
                                       ISO3,
                                       latest_value)

indicator_8_5_1_average_hourly <-
  indicator_8_5_1_average_hourly |> select(
    indicator_reference,
    geoAreaName,
    parentName,
    type,
    X,
    Y,
    ISO3,
    sex_code,
    sex_desc,
    type_of_occupation_desc,
    latest_value
  )

indicator_8_5_2_unemployment <-
  indicator_8_5_2_unemployment |> select(
    indicator_reference,
    geoAreaName,
    parentName,
    type,
    X,
    Y,
    ISO3,
    sex_code,
    sex_desc,
    disability_status_code,
    disability_status_desc,
    latest_value
  )

world <- select(World, ISO3 = "iso_a3", geometry = "geometry")
```

# Relationship between nation's legal framework achievements in gender equality and woman's success in the economy.

## Purpose of This Presentation

In a report published by the International Monetary Fund titled "Tackling Legal Impediments to Women's Economic Empowerment"[^1] 2022, The report highlighted how legal framework has help improve woman's success in the economy of various countries such as Iceland, Peru & Rwanda.

[^1]: Christopherson Puh, K. M., Yiadom, A., Johnson, J., Fernando, F., Yazid, H., & Thiemann, C. (2022). Tackling Legal Impediments to Women's Economic Empowerment, IMF Working Papers, 2022(037), A001. Retrieved Jul 19, 2023, from https://doi.org/10.5089/9798400203640.001.A001

## Purpose of This Presentation (cont)

This presentation thus aims to explore the relationship between nation's legal framework achievements in gender equality and woman's success in the economy. offering insights into the significance of legal framework in gender equality and woman's status in a country economy.

## Research Questions

To what extent does a nation's legal framework on gender equality affect economic growth for women?

Specifically, what is the relationship between a [nation's legal framework achievements in gender equality]{.underline} and [woman's success in the economy]{.underline}?

Can [GDP]{.underline}, [Happy Planet Index Score]{.underline} and [Continent]{.underline} serve as predictors for a nation's legal framework achievements in gender equality & proportion of women in managerial positions?

## Importance of This Research

-   Economic empowerment:

The economic empowerment of women has broader implications for overall economic development.

-   Policy formulation:

Inform policymakers and lawmakers about the effectiveness and relevance of legal frameworks in fostering economic growth for women.

## Importance of This Research

-   Gender equality:

The impact of these legal frameworks is crucial in advancing gender equality efforts.

-   Societal impact:

Sheds light on the potential benefits and consequences of legal frameworks on economic growth, impacting woman's lives and opportunities.

## UN Sustainable Development Goals

Women participation in the economy is related to Goals 5 and 8.

```{r}
#| label: un-goals
#| fig-align: center

include_graphics("data/un_goals_img.jpg")
```

## Selected Indicators

<small> **Indicator 5.1.1**: Legal frameworks that promote, enforce and monitor gender equality (percentage of achievement 0 - 100) \-- Area 3: employment and economic benefits

**Indicator 5.5.2:** Proportion of women in managerial positions

**Indicator 8.5.1:** Average hourly earnings of employees by sex, age, occupation and persons with disabilities

**Indicator 8.5.2:** Unemployment rate by sex, age and persons with disabilities </small>

## Map of Percentage of Achievement in Legal Frameworks on Gender Equality

```{r}
#| label: ge-map
#| fig-align: center

# Wong Jun HAO

cmap_511 <-
  world |>
  left_join(indicator_5_1_1_frameworks, by = c("ISO3"))

cmap_511 <-
  mutate(cmap_511,
         percent = cut(
           latest_value,
           breaks = c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90,
                      max(latest_value, na.rm = TRUE)),
           labels = c(
             "0 to 10",
             "10 to 20",
             "20 to 30",
             "30 to 40",
             "40 to 50",
             "50 to 60",
             "60 to 70",
             "70 to 80",
             "80 to 90",
             "90 to 100"
           )
         ))


tm_poa_after_shape <-
  tm_polygons(col = "percent",
              palette = "Greens",
              title = "Percentage of \nachievement") +
  tm_layout(
    legend.position = c("left", "top"),
    inner.margins = c(0.01, 0.2, 0.01, 0.01),
    bg.color = "lightblue",
    earth.boundary = TRUE,
    space.color = "cornsilk1",
    frame = FALSE
  ) +
  tm_text("ISO3", size = "AREA") +
  tm_credits("Source: United Nations Statistics Division",
             position = c("left", "bottom"))

tm_poa <-
  tm_shape(cmap_511, projection = "ESRI:54012") +
  tm_poa_after_shape

tm_poa
```

## Map of Proportion of Women in Managerial Positions

```{r}
#| label: managerial-map
#| fig-align: center

# Wong Jun HAO

cmap_552 <-
  world |>
  left_join(indicator_5_5_2_managerial, by = c("ISO3"))

cmap_552 <-
  mutate(cmap_552,
         percent = cut(
           latest_value,
           breaks = c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90,
                      max(latest_value, na.rm = TRUE)),
           labels = c(
             "0 to 10",
             "10 to 20",
             "20 to 30",
             "30 to 40",
             "40 to 50",
             "50 to 60",
             "60 to 70",
             "70 to 80",
             "80 to 90",
             "90 to 100"
           )
         ))



tm_poa_after_shape <-
  tm_polygons(col = "percent",
              palette = "Greens",
              title = "Percentages") +
  tm_layout(
    legend.position = c("left", "top"),
    inner.margins = c(0.01, 0.2, 0.01, 0.01),
    bg.color = "lightblue",
    earth.boundary = TRUE,
    space.color = "cornsilk1",
    frame = FALSE
  ) +
  tm_text("ISO3", size = "AREA") +
  tm_credits("Source: United Nations Statistics Division",
             position = c("left", "bottom"))

tm_poa <-
  tm_shape(cmap_552, projection = "ESRI:54012") +
  tm_poa_after_shape

tm_poa
```

## Anticipation of the effect of Legal Gender Equality Frameworks on Women in Managerial Positions

We anticipate that the higher the nation's legal framework achievements in gender equality will result in a higher percentage of women holding managerial positions.

-   Because the chance of gender-based discrimination should be reduced as a result of the legal frameworks in place, this should result in better opportunities for women to hold managerial positions.

## Legal Frameworks on Gender Equality vs Women in Managerial Positions

::: columns
::: {.column width="40%"}
<small>There seem to be a weak correlation between the percentage of achievement in legal employment and benefit frameworks for females, and the percentage of woman in managerial position. The data distribution for the percentage of achievement in legal employment is left skewed and percentage of woman in managerial position is normally distributed.</small>
:::

::: {.column width="60%"}
```{r}
#| label: ge-managerial-pp

# Wong Jun HAO

formatted_5_1_1 <-
  select(
    indicator_5_1_1_frameworks,
    ISO3 = "ISO3",
    Country = "geoAreaName",
    "% Employment Legal Framework Achievement" = "latest_value"
  ) |>
  distinct(ISO3, .keep_all = TRUE)

formatted_5_5_2 <-
  select(
    indicator_5_5_2_managerial,
    ISO3 = "ISO3",
    Country = "geoAreaName",
    "% Female in Management Position" = "latest_value"
  ) |>
  distinct(ISO3, .keep_all = TRUE)

merged_data <- formatted_5_1_1 |>
  left_join(formatted_5_5_2,
            by = c("ISO3", "Country"),
            relationship = "many-to-many") |>
  drop_na() |>
  distinct(ISO3, .keep_all = TRUE)

plot <- ggpairs(
  merged_data,
  mapping = aes(alpha = 0.7, fill = Country),
  columns = c(
    "% Employment Legal Framework Achievement",
    "% Female in Management Position"
  ),
  columnLabels = c(
        "% Employment Legal \nFramework Achievement",
    "% Female in \nManagement Position"
  ),
  diag = list(continuous = wrap(
    "barDiag",
    bins = 10,
    color = "black",
    alpha = 1
  )),
  lower = list(
    continuous = wrap(
      "points",
      position = position_jitter(height = 1,
                                 width = 0.5),
      fill = "black"
    )
  )
) +
  scale_fill_manual(values = c(rep("burlywood3", nrow(merged_data)))) +
  theme(
    plot.background = element_rect(fill = "transparent", colour = NA),
    text = element_text(size = 8),
    axis.text.x = element_text(size = 8),
    axis.text.y = element_text(size = 8)
  )

# plot
ggplotly(plot, height = 400, width = 600)
```
:::
:::

## Legal Frameworks on Gender Equality vs Women in Managerial Positions Re-expressed

::: columns
::: {.column width="60%"}
```{r}
#| label: ge-managerial-pp-re

# Wong Jun HAO

merged_data <- merged_data |>
  mutate(
    "sqrt % Employment Legal Framework Achievement" =
      sqrt(`% Employment Legal Framework Achievement`)
  )

plot <- ggpairs(
  merged_data,
  mapping = aes(alpha = 0.7, fill = Country),
  columns = c(
    "sqrt % Employment Legal Framework Achievement",
    "% Female in Management Position"
  ),
  columnLabels = c(
        "sqrt % Employment Legal \nFramework Achievement",
    "% Female in Management \nPosition"
  ),
  diag = list(continuous = wrap(
    "barDiag",
    bins = 10,
    color = "black",
    alpha = 1
  )),
  lower = list(
    continuous = wrap(
      "points",
      position = position_jitter(height = 1,
                                 width = 0.5),
      fill = "black"
    )
  )
) +
  scale_fill_manual(values = c(rep("burlywood3", nrow(merged_data)))) +
  theme(
    plot.background = element_rect(fill = "transparent", colour = NA),
    text = element_text(size = 8),
    axis.text.x = element_text(size = 8),
    axis.text.y = element_text(size = 8)
  )

# plot
ggplotly(plot, height = 400, width = 600)
```
:::

::: {.column width="40%"}
<small> The percentage of achievement in legal employment is re-expressed by taking the squared root of the skewed values. This helps to reduce the impact of extreme values and make the distribution more symmetrical. This resulted in an higher correlation significance value increase by 0.021, making it slightly more correlated.</small>
:::
:::

## Map of Average Hourly Earning by Women

```{r}
#| label: he-map

# JEANIE OH JUN NING

# getting exchange rate for USD
exchange_rate <- exchange_rate_latest("USD")

# retrieving only Females
indicator_8_5_1_average_hourly <-
  filter(indicator_8_5_1_average_hourly, sex_code == "F")

# get currency code and country code from country name
indicator_8_5_1_average_hourly <-
  mutate(
    indicator_8_5_1_average_hourly,
    currency_code = countrycode(
      ISO3,
      origin = "iso3c",
      destination = "iso4217c",
      warn = FALSE
    )
  )

# get value in USD
indicator_8_5_1_average_hourly$exchange_usd <-
  exchange_rate$one_usd_is_equivalent_to[
    match(indicator_8_5_1_average_hourly$currency_code,
          exchange_rate$currency)]

indicator_8_5_1_average_hourly$amount_usd <-
  indicator_8_5_1_average_hourly$latest_value /
  indicator_8_5_1_average_hourly$exchange_usd

cmap_851 <-
  world |> left_join(indicator_8_5_1_average_hourly, by = c("ISO3"))

cmap_851 <- mutate(cmap_851,
                   usd_earning = cut(
                     amount_usd,
                     breaks = c(0, 1, 2, 3, 5, 8, 13, 21, 34, 55,
                                max(amount_usd, na.rm = TRUE)),
                     labels = c(
                       "0 to 1",
                       "1 to 2",
                       "2 to 3",
                       "3 to 5",
                       "5 to 8",
                       "8 to 13",
                       "13 to 21",
                       "21 to 34",
                       "34 to 55",
                       "55 and above"
                     )
                   ))

tm_poa_after_shape <-
  tm_polygons(col = "usd_earning",
              palette = "Greens",
              title = "Earnings in USD") +
  tm_layout(
    legend.position = c("left", "top"),
    inner.margins = c(0.01, 0.2, 0.01, 0.01),
    bg.color = "lightblue",
    earth.boundary = TRUE,
    space.color = "cornsilk1",
    frame = FALSE
  ) +
  tm_text("ISO3", size = "AREA") +
  tm_credits("Source: United Nations Statistics Division",
             position = c("left", "bottom"))

tm_poa <- tm_shape(cmap_851, projection = "ESRI:54012") +
  tm_poa_after_shape

tm_poa
```

## Map of Unemployment Rate of Women

```{r}
#| label: unemploy-map

# JEANIE OH JUN NING

# retrieving only Females
indicator_8_5_2_unemployment <-
  filter(indicator_8_5_2_unemployment, sex_code == "F")

cmap_852 <-
  world |> left_join(indicator_8_5_2_unemployment, by = c("ISO3"))

cmap_852 <-
  mutate(cmap_852,
         percent = cut(
           latest_value,
           breaks = c(0, 5, 10, 15, 20, 30, 40,
                      max(latest_value, na.rm = TRUE)),
           labels = c(
             "0 to 5",
             "5 to 10",
             "10 to 15",
             "15 to 20",
             "20 to 30",
             "30 to 40",
             "40 to 50"
           )
         ))



tm_poa_after_shape <-
  tm_polygons(col = "percent",
              palette = "Greens",
              title = "Percentages") +
  tm_layout(
    legend.position = c("left", "top"),
    inner.margins = c(0.01, 0.2, 0.01, 0.01),
    bg.color = "lightblue",
    earth.boundary = TRUE,
    space.color = "cornsilk1",
    frame = FALSE
  ) +
  tm_text("ISO3", size = "AREA") +
  tm_credits("Source: United Nations Statistics Division",
             position = c("left", "bottom"))

tm_poa <-
  tm_shape(cmap_852, projection = "ESRI:54012") +
  tm_poa_after_shape

tm_poa
```

## Anticipation of effects of unemployment rates on hourly earnings for women

We anticipate that countries with lower unemployment rates for women should have higher average hourly earnings for women.

-   Because countries with lower unemployment rates have a better economic environment which should result in higher average income for their citizens

## Unemployment Rates vs Hourly Earnings FOR Women

::: columns
::: {.column width="40%"}
<small>A correlation of -0.097 indicates a weak negative relationship between unemployment rate for women and average hourly earning (USD) for women. Both data distribution are right-skewed.</small>
:::

::: {.column width="60%"}
```{r}
#| label: unemploy-he-pp

# JEANIE OH JUN NING

formatted_8_5_1 <-
  select(
    indicator_8_5_1_average_hourly,
    ISO3 = "ISO3",
    Country = "geoAreaName",
    "Average Hourly Earning in USD for Female" = "amount_usd"
  ) |>
  distinct(ISO3, .keep_all = TRUE)


formatted_8_5_2 <-
  select(
    indicator_8_5_2_unemployment,
    ISO3 = "ISO3",
    Country = "geoAreaName",
    "% Female that is Unemployed" = "latest_value"
  ) |>
  distinct(ISO3, .keep_all = TRUE)


merged_data <- formatted_8_5_1 |>
  left_join(formatted_8_5_2,
            by = c("ISO3", "Country"),
            relationship = "many-to-many") |>
  drop_na()

plot <- ggpairs(
  merged_data,
  mapping = aes(alpha = 0.7, fill = Country),
  columns = c(
    "Average Hourly Earning in USD for Female",
    "% Female that is Unemployed"
  ),
  columnLabels = c(
        "Average Hourly Earning \nin USD for Female",
    "% Female that \nis Unemployed"
  ),
  diag = list(continuous = wrap(
    "barDiag",
    bins = 10,
    color = "black",
    alpha = 1
  )),
  lower = list(continuous = wrap("points",
                                 position = position_jitter(
                                   height = 1,
                                   width = 0.5
                                 )))
) +
  scale_fill_manual(values = c(rep("burlywood3", nrow(merged_data)))) +
  theme(
    plot.background = element_rect(fill = "transparent",colour = NA),
    text = element_text(size = 8),
    axis.text.x = element_text(size = 8),
    axis.text.y = element_text(size = 8)
  )

# plot
ggplotly(plot, height = 400, width = 600)
```
:::
:::

## Unemployment Rates vs Hourly Earnings FOR Women re-expressed

::: columns
::: {.column width="60%"}
```{r}
#| label: unemploy-he-pp-re

# JEANIE OH JUN NING

merged_data <- merged_data |>
  mutate(
    "sqrt Average Hourly Earning in USD for Female" =
      sqrt(`Average Hourly Earning in USD for Female`),
    "log10 % Female that is Unemployed" =
      log10(`% Female that is Unemployed`),
  ) |>
  distinct(ISO3, .keep_all = TRUE)


plot <- ggpairs(
  merged_data,
  mapping = aes(alpha = 0.7, fill = Country),
  columns = c(
    "sqrt Average Hourly Earning in USD for Female",
    "log10 % Female that is Unemployed"
  ),
  columnLabels = c(
    "sqrt Average Hourly Earnings \nin USD for Female",
    "log10 % Female \nthat is Unemployed"
  ),
  diag = list(continuous = wrap(
    "barDiag",
    bins = 10,
    color = "black",
    alpha = 1
  )),
  lower = list(
    continuous = wrap(
      "points",
      position = position_jitter(height = 1,
                                 width = 0.5),
      fill = "black"
    )
  )
) +
  scale_fill_manual(values = c(rep("burlywood3", nrow(merged_data)))) +
  theme(
    plot.background = element_rect(fill = "transparent",colour = NA),
    text = element_text(size = 8),
    axis.text.x = element_text(size = 8),
    axis.text.y = element_text(size = 8)
  )


# plot
ggplotly(plot, height = 400, width = 600)
```
:::

::: {.column width="40%"}
<small>The two indicators are transformed using square root and logarithm respectively, making extreme values more symmetrical. This resulted in an insignificant correlation value increase by 0.103, with a correlation that is very close to zero, indicating that there is virtually no relationship between them.</small>
:::
:::

## Table of Women Economical Success

```{r}
#| label: indicators

# CHIA YI XUAN

table_5_1_1 <- indicator_5_1_1_frameworks |>
  select("Country" = geoAreaName, ISO3, "% Legal Frameworks" = latest_value) |>
  distinct(ISO3, .keep_all = TRUE)


table_5_2_2 <- indicator_5_5_2_managerial |>
  select("Country" = geoAreaName,
         ISO3,
         "% Managerial Positions" = latest_value) |>
  distinct(ISO3, .keep_all = TRUE)


table_8_5_1 <- indicator_8_5_1_average_hourly |>
  select("Country" = geoAreaName,
         ISO3,
         "Average Hourly Earnings $USD" = amount_usd, 2) |>
  distinct(ISO3, .keep_all = TRUE)

table_8_5_1$`Average Hourly Earnings $USD` <-
  round(table_8_5_1$`Average Hourly Earnings $USD`, 2)

table_8_5_2 <- indicator_8_5_2_unemployment |>
  select(
    "Country" = geoAreaName,
    ISO3,
    disability_status_desc,
    "sex" = sex_desc,
    "% Females Unemployed" = latest_value
  ) |>
  filter(`sex` %in% c("Female"),
         disability_status_desc == "No breakdown by disability") |>
  select(Country, ISO3, "% Females Unemployed") |>
  distinct(ISO3, .keep_all = TRUE)

merged_table <- table_5_1_1 |>
  left_join(table_5_2_2, by = c("ISO3", "Country")) |>
  left_join(table_8_5_2, by = c("ISO3", "Country")) |>
  left_join(table_8_5_1, by = c("ISO3", "Country")) |>
  select(
    Country,
    `% Legal Frameworks`,
    `% Managerial Positions`,
    `% Females Unemployed`,
    `Average Hourly Earnings $USD`
  )

merged_table |>
  datatable(rownames = FALSE,
            options = list(initComplete = htmlwidgets::JS(
              "function(settings, json) {",
              paste0(
                "$(this.api().table().container()).css({'font-size': '50%'});"
              ),
              "}"
            )))
```

## Anticipation of what Achievement of Legal Frameworks on Gender Equality does to Female Unemployment

We anticipate that having a higher the nation's legal framework achievements on gender equality would result in lower unemployment rate for women.

-   Because by decreasing gender discrimination for women, more companies would be willing to employ women.

## Legal Frameworks on Gender Equality vs Female Unemployment

::: columns
::: {.column width="40%"}
<small>There doesn't seem to be any significant correlation between the percentage of legal employment and benefit frameworks for females, and the unemployment rate of females. However, this might be due to skewed distributions, hence we will re-express this data. </small>
:::

::: {.column width="60%"}
```{r}
#| label: ge-unemploy-pp
#| fig-height: 4
#| fig-width: 6
# CHIA YI XUAN

# format 5.1.1 data into focused columns
formatted_5_1_1 <- indicator_5_1_1_frameworks |>
  # drop_na(latest_value) |>
  select("Country" = geoAreaName,
         ISO3,
         "% Gender Equality Frameworks" = latest_value) |>
  distinct(ISO3, .keep_all = TRUE)

# format 8.5.2 data into focused columns
formatted_8_5_2 <- indicator_8_5_2_unemployment |>
  drop_na(latest_value) |>
  select(
    "Country" = geoAreaName,
    ISO3,
    disability_status_desc,
    "sex" = sex_desc,
    "% Females Unemployed" = latest_value
  ) |>
  filter(`sex` %in% c("Female"),
         disability_status_desc == "No breakdown by disability") |>
  select(Country, ISO3, sex, "% Females Unemployed") |>
  distinct(ISO3, .keep_all = TRUE)



# merge data using left join, and drop all NA rows
merged_data <- formatted_8_5_2 |>
  left_join(formatted_5_1_1, by = c("ISO3", "Country")) |>
  drop_na()


# initial
plot <- ggpairs(
  merged_data,
  mapping = aes(alpha = 0.7, fill = Country),
  columns = c("% Gender Equality Frameworks",
              "% Females Unemployed"),
  columnLabels = c("% Gender Equality \nFrameworks", "% Females \nUnemployed"),
  diag = list(continuous = wrap(
    "barDiag",
    bins = 10,
    color = "black",
    alpha = 1
  )),
  lower = list(continuous = wrap("points",
                                 position = position_jitter(
                                   height = 1,
                                   width = 0.5
                                 )))
) +
  scale_fill_manual(values = c(rep("burlywood3", nrow(merged_data)))) +
  theme(plot.background = element_rect(fill = "transparent", colour = NA),
        text = element_text(size = 12),
        axis.text.x = element_text(size = 8),
        axis.text.y = element_text(size = 8))
ggplotly(plot, height = 400, width = 600)
# plot
```
:::
:::

## Legal Frameworks on Gender Equality vs Female Unemployment Re-Expressed

::: columns
::: {.column width="60%"}
```{r}
#| label: ge-unemploy-pp-re
#| fig-height: 4
#| fig-width: 6
# CHIA YI XUAN

# Perform transformation
merged_data <- merged_data |>
  mutate(
    "log_10(% Females Unemployed)" = log10(`% Females Unemployed`),
    "sqrt(% Gender Equality Frameworks)" =
      sqrt(`% Gender Equality Frameworks`)
  )


# re-expressed plot
plot <- ggpairs(
  merged_data,
  mapping = aes(alpha = 0.7, fill = Country),
  columns = c(
    "sqrt(% Gender Equality Frameworks)",
    "log_10(% Females Unemployed)"
  ),
  columnLabels = c("sqrt(% Gender \nEquality Frameworks)", 
                   "log_10(% Females \nUnemployed)"),
  diag = list(continuous = wrap(
    "barDiag",
    bins = 8,
    color = "black",
    alpha = 1
  )),
  lower = list(continuous = wrap("points",
                                 position = position_jitter(
                                   height = 1,
                                   width = 0.5
                                 )))
) +
  scale_fill_manual(values = c(rep("burlywood3", nrow(merged_data)))) +
  theme(
    plot.background = element_rect(fill = "transparent", colour = NA),
        text = element_text(size = 10),
        axis.text.x = element_text(size = 8),
        axis.text.y = element_text(size = 8))

ggplotly(plot, height = 400, width = 600)
# plot
```
:::

::: {.column width="40%"}
<small>After logarithmic and square root transformations, correlation coefficient seems to have improved positively. However, it still appears to be insignificant. </small>
:::
:::

## Anticipation of women in managerial positions on women average hourly earnings

We anticipate that having more women in managerial positions will increase the average hourly earning for female employees.

-   Because in general, employees in a managerial position would receive higher income and with more women holding managerial positions, the average hourly earning for female employees will increase.

## women in managerial positions vs women average hourly earnings

::: columns
::: {.column width="40%"}
<small> There seems to be a negative correlation between the percentage of female hourly earnings and women in managerial positions. However, this might be due to skewed distributions of female hourly earnings, hence we will re-express this data using logarithmic transformations . </small>
:::

::: {.column width="60%"}
```{r}
#| label: managerial-he-pp
#| fig-height: 4
#| fig-width: 6

# Gu jin ming

# Format 5.5.2 data into focused columns
formatted_5_5_2 <- indicator_5_5_2_managerial |>
  drop_na(latest_value) |>
  select("Country" = geoAreaName,
         ISO3,
         "% Women in Managerial Positions" = latest_value) |>
  distinct(ISO3, .keep_all = TRUE)

# Format 8.5.1 data into focused columns
formatted_8_5_1 <- indicator_8_5_1_average_hourly |>
  drop_na(latest_value) |>
  filter(sex_desc == "Female") |>
  select("Country" = geoAreaName,
         ISO3,
         "Female Hourly Earnings" = amount_usd) |>
  distinct(ISO3, .keep_all = TRUE)

# Merge data using left join, and drop all NA rows
merged_data <- formatted_5_5_2 |>
  left_join(formatted_8_5_1, by = c("ISO3", "Country")) |>
  drop_na()



# Create 4 grid plots using ggpairs()
grid_plots <- ggpairs(
  merged_data,
  mapping = aes(alpha = 0.7, fill = Country),
  columns = c("% Women in Managerial Positions", "Female Hourly Earnings"),
  columnLabels = c("% Women in \nManagerial Positions",
                   "Female Hourly \nEarnings"),
  diag = list(continuous = wrap(
    "barDiag",
    bins = 8,
    color = "black",
    alpha = 1
  )),
  lower = list(continuous = wrap("points",
                                 position = position_jitter(
                                   height = 1,
                                   width = 0.5
                                 )))
) +
  scale_fill_manual(values = c(rep("burlywood3", nrow(merged_data)))) +
  theme(plot.background = element_rect(fill = "transparent", colour = NA))

ggplotly(grid_plots, height = 400, width = 600)
```
:::
:::

## women in managerial positions vs women average hourly earnings re-expressed

::: columns
::: {.column width="60%"}
```{r}
#| label: managerial-he-pp-re
#| fig-height: 4
#| fig-width: 6

# Gu jin ming
# Correlation Graph

merged_data <- merged_data |>
  mutate("sqrt(Female Hourly Earnings USD)" = sqrt(`Female Hourly Earnings`))

# Create 4 grid plots using ggpairs()
grid_plots <- ggpairs(
  merged_data,
  mapping = aes(alpha = 0.7, fill = Country),
  columns = c(
    "% Women in Managerial Positions",
    "sqrt(Female Hourly Earnings USD)"
  ),
  columnLabels = c(
    "% Women in \nManagerial Positions",
    "sqrt(Female Hourly \nEarnings)"
  ),
  diag = list(continuous = wrap(
    "barDiag",
    bins = 8,
    color = "black",
    alpha = 1
  )),
  lower = list(continuous = wrap("points",
                                 position = position_jitter(
                                   height = 1,
                                   width = 0.5
                                 )))
) +
  scale_fill_manual(values = c(rep("burlywood3", nrow(merged_data)))) +
  theme(plot.background = element_rect(fill = "transparent", colour = NA))


ggplotly(grid_plots, height = 400, width = 600)
```
:::

::: {.column width="40%"}
<small> There still seems to be a negative correlation between the percentage of female hourly earnings and women in managerial positions after logarithmic transformations . </small>
:::
:::

## Comparison of the four indicators

```{r}
#| label: four-indicator-pp

# Yi Xuan and Jin Ming
# format 5.1.1 data into focused columns
formatted_5_1_1 <- indicator_5_1_1_frameworks |>
  drop_na(latest_value) |>
  select("Country" = geoAreaName,
         ISO3,
         "% Gender Equality Frameworks" = latest_value) |>
  distinct(ISO3, .keep_all = TRUE)

# format 8.5.2 data into focused columns
formatted_8_5_2 <- indicator_8_5_2_unemployment |>
  drop_na(latest_value) |>
  select(
    "Country" = geoAreaName,
    ISO3,
    disability_status_desc,
    "sex" = sex_desc,
    "% Females Unemployed" = latest_value
  ) |>
  filter(`sex` %in% c("Female"),
         disability_status_desc == "No breakdown by disability") |>
  select(Country, ISO3, sex, "% Females Unemployed") |>
  distinct(ISO3, .keep_all = TRUE)

# Format 5.5.2 data into focused columns
formatted_5_5_2 <- indicator_5_5_2_managerial |>
  drop_na(latest_value) |>
  select("Country" = geoAreaName,
         ISO3,
         "% Women in Managerial Positions" = latest_value) |>
  distinct(ISO3, .keep_all = TRUE)

# Format 8.5.1 data into focused columns
formatted_8_5_1 <- indicator_8_5_1_average_hourly |>
  drop_na(latest_value) |>
  filter(sex_desc == "Female") |>
  select("Country" = geoAreaName,
         ISO3,
         "Female Hourly Earnings" = amount_usd) |>
  distinct(ISO3, .keep_all = TRUE)


# merge data using left join, and drop all NA rows
merged_data <- formatted_8_5_2 |>
  left_join(formatted_5_1_1, by = c("ISO3", "Country")) |>
  left_join(formatted_5_5_2, by = c("ISO3", "Country")) |>
  left_join(formatted_8_5_1, by = c("ISO3", "Country"))

# Perform sqrt transformation and log transformation
merged_data <- merged_data |>
  mutate("sqrt(Female Hourly Earnings USD)" = sqrt(`Female Hourly Earnings`)) |>
  mutate("log_10(% Females Unemployed)" = log10(`% Females Unemployed`)) |>
  mutate("sqrt(% Gender Equality Frameworks)" =
           sqrt(`% Gender Equality Frameworks`))

merged_data <- drop_na(merged_data)
grid_plots <- ggpairs(
  merged_data,
  mapping = aes(alpha = 0.7, fill = Country),
  title = "Relationship between Indicators",
  columns = c(
    "sqrt(% Gender Equality Frameworks)",
    "log_10(% Females Unemployed)",
    "% Women in Managerial Positions",
    "sqrt(Female Hourly Earnings USD)"
  ),
  columnLabels = c(
    "sqrt(% Gender \nEquality Frameworks)",
    "log_10(% Females\n Unemployed)",
    "% Women in \nManagerial Positions",
    "sqrt(Female Hourly\n Earnings USD)"
  ),
  diag = list(continuous = wrap(
    "barDiag",
    bins = 8,
    color = "black",
    alpha = 1
  )),
  lower = list(continuous = wrap("points",
                                 position = position_jitter(
                                   height = 1, width = 0.5
                                 )))
) +
  scale_fill_manual(values = c(rep("burlywood3", nrow(merged_data)))) +
  theme(plot.background = element_rect(fill = "transparent", colour = NA),
        text = element_text(size = 8),
        axis.text.x = element_text(size = 8),
        axis.text.y = element_text(size = 8))

# Print the grid plots
# grid_plots
ggplotly(grid_plots, height = 600, width = 1000)
```

## K-Means Clustering

::: columns
Considering the four selected Sustainable Development Goals, what is an appropriate number, k, of clusters for countries?

::: {.column width="60%"}
```{r}
#| label: k-means-plot

# VARADHARAJAN JAYAPRIYA
# merge data using left join, and drop all NA rows

merged_data <- formatted_8_5_2 |>
  left_join(formatted_5_1_1,
            by = c("ISO3", "Country")) |>
  left_join(formatted_5_5_2,
            by = c("ISO3", "Country")) |>
  left_join(formatted_8_5_1,
            by = c("ISO3", "Country"))

# Perform re-scaling
normalised_data <- merged_data |>
  mutate("sqrt(Female Hourly Earnings USD)" = sqrt(`Female Hourly Earnings`)) |>
  mutate("log_10(% Females Unemployed)" = log10(`% Females Unemployed`)) |>
  mutate("sqrt(% Gender Equality Frameworks)" =
           sqrt(`% Gender Equality Frameworks`))

# Drop rows with NA values
normalised_data <- drop_na(normalised_data)

normalised_data_cols <-
  normalised_data[, c("sqrt(% Gender Equality Frameworks)",
                                            "log_10(% Females Unemployed)",
                                            "% Women in Managerial Positions",
                                            "sqrt(Female Hourly Earnings USD)")]
set.seed(123)

# Elbow plot to determine the optimal k value
elbow_data <- data.frame(k = 1:10, total_withinss = numeric(10))

#Elbow Method
plot <- fviz_nbclust(normalised_data_cols, kmeans, method = "wss") +
  theme(
    plot.background = element_rect(fill = "transparent", colour = NA)
  )

ggplotly(plot, height = 400, width = 600)

```
:::

::: {.column width="40%"}
The 'elbow criterion' suggests k = 2 or 3. We choose k=3, but this decision is admittedly subjective.
:::
:::

## Pairs Plot Highlighting Clusters

::: columns
::: {.column width="75%"}
```{r}
#| label: cluster-pp

# See project-sample slide 20

# Perform k-means clustering with k = 3
set.seed(123)
km_out <- kmeans(normalised_data_cols, centers = 3, nstart = 20)

# Add cluster information to the merged_data dataframe
normalised_data$Cluster <- km_out$cluster

# Create a pair plot using ggpairs
plot <- ggpairs(normalised_data,
        columns = c(
          "sqrt(% Gender Equality Frameworks)",
          "log_10(% Females Unemployed)",
          "% Women in Managerial Positions",
          "sqrt(Female Hourly Earnings USD)"),
        columnLabels = c(
          "sqrt(% Gender \nEquality Frameworks)",
          "log_10(% Females\n Unemployed)",
          "% Women in \nManagerial Positions",
          "sqrt(Female Hourly\n Earnings USD)"
        ),
        mapping = aes(color = as.factor(Cluster)),
        title = "Pair Plot with K-means Clustering (k = 3)",
        diag = list(continuous = wrap("barDiag", bins = 10, color = "black")),
        lower = list(continuous = wrap("points",
                                       position = position_jitter(height = 1,
                                                                  width = 0.5),
                                       fill = "black"))
) +
  scale_fill_manual(values = c("#f8766d", "#00bfc4", "#56B4E9", "#E69F00")) +
  theme(
    plot.background = element_rect(fill = "transparent", colour = NA),
    text = element_text(size = 8),
    axis.text.x = element_text(size = 8),
    axis.text.y = element_text(size = 8)
  )

ggplotly(plot, height = 600, width = 700)

```
:::

::: {.column width="25%"}
<small> [1. High Achievement of Legal Frameworks on Gender Equality and High Female earnings]{style="color:#f8766d"} <br /> <br /> [2. High Achievement of Legal Frameworks on Gender Equality and Low Women in Managerial Positions]{style="color:#00bfc4"} <br /> <br /> [3. High Achievement of Legal Frameworks on Gender Equality and High Percentage of Women in Managerial Positions]{style="color:#56B4E9"} </small>
:::
:::

## Decision Tree (Classification) {data-transitions="slide-in"}

::: columns
```{r}
#| label: d-tree
#| echo: false
#| message: FALSE
#| results: 'hide'

# TSUI SAU CHI (JAMES)

# Load Country Level Data

# Step1: Import Data
happy_index <-
  read_excel(
    "data/happy-planet-index-2006-2020-public-data-set.xlsx",
    sheet = 2,
    skip = 7
  )
happy_index <-
  select(
    happy_index, ISO3 = "ISO", GDP = "GDP per capita ($)", HPI
    )

countries_sf <- st_read("data/WB_countries_Admin0.geojson")
countries_sf  <-
  select(countries_sf, Continent = "CONTINENT", ISO3 = "ISO_A3")
countries_sf <- st_drop_geometry(countries_sf)
countries_sf <- as_tibble(countries_sf)

```

Can the cluster assignment be predicted based on the country's [GDP]{.underline}, [Happy Planet Index Score]{.underline} and [Continent]{.underline}?

::: {.column width="75%"}
```{r}
#| label: d-tree-extended
# Step1: Import Data & Data-preprocessing
merged_data <- select(
  normalised_data, ISO3 = "ISO3", cluster_id = "Cluster") |> drop_na()

# Merge data using left join, and drop all NA rows
merged_data <-  merged_data |>
  left_join(countries_sf, by = c("ISO3")) |>
  drop_na()

merged_data <-  merged_data |>
  left_join(happy_index, by = c("ISO3")) |>
  drop_na()

merged_data <- distinct(merged_data)

merged_data$Continent <- as.factor(merged_data$Continent)
merged_data$GDP <- round(as.numeric(merged_data$GDP), 2)
merged_data$cluster_id <- as.factor(merged_data$cluster_id)
merged_data <- merged_data %>% select(-ISO3)
merged_data <- na.omit(merged_data)

# # Shuffle Data
shuffle_index <- sample(seq_len(nrow(merged_data)))
merged_data <- merged_data[shuffle_index, ]

# Step 2: Create training / Test Set
set.seed(123)
data_split <- initial_split(merged_data, prop = 0.8)
train_data <- training(data_split)
test_data <- testing(data_split)

# Step 3: Build the model
tree <-
  rpart(
    cluster_id ~ .,
    data = train_data,
    method = "class",
    minsplit = 6,
    minbucket = 2
  )
train_data$predicted <- predict(tree, type = "class")

# Plot the decision tree with a transparent background
par(bg = NA)
rpart.plot(tree,
           digits = -3,
           box.palette = list("#f8766d", "#00bfc4", "#56B4E9"))
```
:::

::: {.column width="25%"}
<small> [1. High earnings and High Achievement of Legal Frameworks on Gender Equality]{style="color:#f8766d"} <br /> <br /> [2. High Achievement of Legal Frameworks on Gender Equality and Low Women in Managerial Positions]{style="color:#00bfc4"} <br /> <br /> [3. High Percentage of Women in Managerial Positions]{style="color:#56B4E9"} </small>
:::
:::

## Evaluation of Decision Tree

```{r}
#| label: d-tree-eval
#| echo: false
#| message: FALSE
#| results: 'hide'

# Step 4: Evaluating Model


ctrl <- trainControl(method = "cv", number = 10)
model <-
  train(
    cluster_id ~ .,
    data = merged_data,
    method = "rpart",
    trControl = ctrl,
    minsplit = 6,
    minbucket = 1
  )
model

# Step 5: Get Relative Importance
relative_importance <-
  vector(length = length(tree$variable.importance))
for (i in seq_along(length(tree$variable.importance))) {
  relative_importance[i] <- tree$variable.importance[i] /
    tree$variable.importance[1]
}
```

Ten-fold cross validation indicates that the decision tree has a accuracy of `r max(model$results$Accuracy)`.\
Kappa Value is shown to be `r model$results$Kappa[which.max(model$results$Accuracy)]`.

The relative importance of the predictors for classification are as follows:

-   `r names(tree$variable.importance)[1]`: `r relative_importance[1]`
-   `r names(tree$variable.importance)[2]`: `r relative_importance[2]`
-   `r names(tree$variable.importance)[3]`: `r relative_importance[3]`

## Summary of Quantitative Results

-   Correlation between same-goal indicators.
-   Correlation between legal employment and benefit frameworks for females and the representation of women in managerial positions.
-   No correlation between female hourly earnings USD and females unemployment rate.
-   Little correlations of statistical significance are observed between indicators for different goals.
-   Potentially influenced by the country's originally high unemployment rates across all genders.
-   Many missing. Only 35 of 68 countries have data for all four indicators.

## Policy Implications

-   Achievement of Legal Frameworks on Gender Equality does indeed affect Economic Growth for women.
-   Higher Achievement of Legal Frameworks on Gender Equality has a strong correlation with higher Average Hourly Earnings for Women.
-   GDP does serve as a predictor for a nation's legal framework achievements in gender equality & proportion of women in managerial positions.
-   Assist nations in enhancing their data gathering methods to facilitate informed decision-making.

```{r}
#| label: lint

lint("csc3007-black2.qmd")
```
